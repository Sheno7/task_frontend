{"ast":null,"code":"import _regeneratorRuntime from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/src/middleware/AuthMiddleware.js\";\nimport React, { Component } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport axios from 'axios';\nimport { connect } from 'react-redux';\n\nvar AuthMiddleware =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AuthMiddleware, _Component);\n\n  function AuthMiddleware(props) {\n    var _this;\n\n    _classCallCheck(this, AuthMiddleware);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AuthMiddleware).call(this, props));\n    _this.state = {\n      loading: true,\n      redirect: false\n    };\n    return _this;\n  }\n\n  _createClass(AuthMiddleware, [{\n    key: \"componentWillMount\",\n    value: function () {\n      var _componentWillMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return axios.post(process.env.REACT_APP_ADMIN_URL + '/checktoken', {}, {\n                  headers: {\n                    'Authorization': 'Bearer ' + this.props.token\n                  }\n                });\n\n              case 3:\n                this.setState({\n                  loading: false\n                });\n                _context.next = 10;\n                break;\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](0);\n                this.props.Logout();\n                this.setState({\n                  loading: false,\n                  redirect: true\n                });\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 6]]);\n      }));\n\n      function componentWillMount() {\n        return _componentWillMount.apply(this, arguments);\n      }\n\n      return componentWillMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          loading = _this$state.loading,\n          redirect = _this$state.redirect;\n\n      if (loading) {\n        return null;\n      }\n\n      if (redirect) {\n        return React.createElement(Redirect, {\n          to: \"/login\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 32\n          },\n          __self: this\n        });\n      }\n\n      return React.cloneElement(this.props.children, {\n        token: this.props.token\n      }); //   return this.props.children.\n    }\n  }]);\n\n  return AuthMiddleware;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    Login: state.login,\n    token: state.token\n  };\n};\n\nvar mapMethodToProps = function mapMethodToProps(dispatch) {\n  return {\n    Logout: function Logout() {\n      dispatch({\n        'type': \"LOGOUT\"\n      });\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapMethodToProps)(AuthMiddleware);","map":{"version":3,"sources":["/media/shenouda/81422b19-5e63-467f-9a2d-c5ca5ac074ba/work/tasks/task2/frontend/src/middleware/AuthMiddleware.js"],"names":["React","Component","Redirect","axios","connect","AuthMiddleware","props","state","loading","redirect","post","process","env","REACT_APP_ADMIN_URL","headers","token","setState","Logout","cloneElement","children","mapStateToProps","Login","login","mapMethodToProps","dispatch"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,OAAR,QAAsB,aAAtB;;IAEMC,c;;;;;AACF,0BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,wFAAMA,KAAN;AACA,UAAKC,KAAL,GAAa;AACTC,MAAAA,OAAO,EAAE,IADA;AAETC,MAAAA,QAAQ,EAAE;AAFD,KAAb;AAFe;AAMlB;;;;;;;;;;;;;;uBAGaN,KAAK,CAACO,IAAN,CAAWC,OAAO,CAACC,GAAR,CAAYC,mBAAZ,GAAkC,aAA7C,EAA2D,EAA3D,EAA8D;AAChEC,kBAAAA,OAAO,EAAC;AAAC,qCAAgB,YAAU,KAAKR,KAAL,CAAWS;AAAtC;AADwD,iBAA9D,C;;;AAGN,qBAAKC,QAAL,CAAc;AAAER,kBAAAA,OAAO,EAAE;AAAX,iBAAd;;;;;;;AAGA,qBAAKF,KAAL,CAAWW,MAAX;AACA,qBAAKD,QAAL,CAAc;AAAER,kBAAAA,OAAO,EAAE,KAAX;AAAkBC,kBAAAA,QAAQ,EAAE;AAA5B,iBAAd;;;;;;;;;;;;;;;;;;6BAGC;AAAA,wBACyB,KAAKF,KAD9B;AAAA,UACGC,OADH,eACGA,OADH;AAAA,UACYC,QADZ,eACYA,QADZ;;AAEL,UAAID,OAAJ,EAAa;AACT,eAAO,IAAP;AACD;;AACD,UAAIC,QAAJ,EAAc;AACZ,eAAO,oBAAC,QAAD;AAAU,UAAA,EAAE,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACD;;AACD,aAAOT,KAAK,CAACkB,YAAN,CAAmB,KAAKZ,KAAL,CAAWa,QAA9B,EAAwC;AAAEJ,QAAAA,KAAK,EAAE,KAAKT,KAAL,CAAWS;AAApB,OAAxC,CAAP,CARG,CASL;AACC;;;;EA9BoBd,S;;AAiC7B,IAAMmB,eAAe,GAAC,SAAhBA,eAAgB,CAACb,KAAD,EAAS;AAC3B,SAAO;AAACc,IAAAA,KAAK,EAACd,KAAK,CAACe,KAAb;AAAmBP,IAAAA,KAAK,EAACR,KAAK,CAACQ;AAA/B,GAAP;AACD,CAFH;;AAGE,IAAMQ,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,QAAD,EAAc;AACrC,SAAO;AACLP,IAAAA,MAAM,EAAE,kBAAM;AAAEO,MAAAA,QAAQ,CAAC;AAAE,gBAAQ;AAAV,OAAD,CAAR;AAA+B;AAD1C,GAAP;AAGD,CAJD;;AAKF,eAAepB,OAAO,CAACgB,eAAD,EAAiBG,gBAAjB,CAAP,CAA0ClB,cAA1C,CAAf","sourcesContent":["import React, { Component } from 'react'\nimport { Redirect } from 'react-router-dom';\nimport axios from 'axios'\nimport {connect} from 'react-redux'\n\nclass AuthMiddleware extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            loading: true,\n            redirect: false,\n          };\n    }\n   async componentWillMount() {\n        try {\n            await axios.post(process.env.REACT_APP_ADMIN_URL + '/checktoken',{},{\n                headers:{'Authorization':'Bearer '+this.props.token},\n            })        \n            this.setState({ loading: false });\n        }\n        catch (error) {\n            this.props.Logout();\n            this.setState({ loading: false, redirect: true });\n        }\n    }\n    render() {\n        const { loading, redirect } = this.state;\n        if (loading) {\n            return null;\n          }\n          if (redirect) {\n            return <Redirect to=\"/login\" />;\n          }\n          return React.cloneElement(this.props.children, { token: this.props.token })\n        //   return this.props.children.\n        }\n\n}\nconst mapStateToProps=(state)=>{\n    return {Login:state.login,token:state.token}\n  };\n  const mapMethodToProps = (dispatch) => {\n    return {\n      Logout: () => { dispatch({ 'type': \"LOGOUT\"}) }\n    }\n  }\nexport default connect(mapStateToProps,mapMethodToProps)(AuthMiddleware);"]},"metadata":{},"sourceType":"module"}